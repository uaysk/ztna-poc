
location /whoami {
    # Static auth_request URI using path-style endpoint
    auth_request /api/check_auth/whoami;

    # If auth fails or backend/UEM errors occur, return 403 (not 500)
    error_page 401 403 404 500 502 503 = @error_response;

    proxy_pass http://172.30.1.1:90;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
